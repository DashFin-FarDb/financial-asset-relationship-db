<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.13.2" xml:lang="en-US">
  <compounddef id="test__requirements_8py" kind="file" language="Python">
    <compoundname>test_requirements.py</compoundname>
    <innerclass refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileExists" prot="public">tests::integration::test_requirements::TestRequirementsFileExists</innerclass>
    <innerclass refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat" prot="public">tests::integration::test_requirements::TestRequirementsFileFormat</innerclass>
    <innerclass refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages" prot="public">tests::integration::test_requirements::TestRequiredPackages</innerclass>
    <innerclass refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications" prot="public">tests::integration::test_requirements::TestVersionSpecifications</innerclass>
    <innerclass refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency" prot="public">tests::integration::test_requirements::TestPackageConsistency</innerclass>
    <innerclass refid="classtests_1_1integration_1_1test__requirements_1_1TestFileOrganization" prot="public">tests::integration::test_requirements::TestFileOrganization</innerclass>
    <innerclass refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance" prot="public">tests::integration::test_requirements::TestSecurityAndCompliance</innerclass>
    <innerclass refid="classtests_1_1integration_1_1test__requirements_1_1TestEdgeCases" prot="public">tests::integration::test_requirements::TestEdgeCases</innerclass>
    <innerclass refid="classtests_1_1integration_1_1test__requirements_1_1TestComprehensiveValidation" prot="public">tests::integration::test_requirements::TestComprehensiveValidation</innerclass>
    <innernamespace refid="namespacetests">tests</innernamespace>
    <innernamespace refid="namespacetests_1_1integration">tests::integration</innernamespace>
    <innernamespace refid="namespacetests_1_1integration_1_1test__requirements">tests::integration::test_requirements</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacetests_1_1integration_1_1test__requirements" refkind="compound"><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="2"><highlight class="stringliteral">Integration<sp/>tests<sp/>for<sp/>requirements.txt<sp/>file.</highlight></codeline>
<codeline lineno="3"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="4"><highlight class="stringliteral">This<sp/>module<sp/>validates<sp/>that<sp/>the<sp/>production<sp/>requirements<sp/>file<sp/>is<sp/>well-</highlight></codeline>
<codeline lineno="5"><highlight class="stringliteral">formatted,<sp/>contains<sp/>required<sp/>packages,<sp/>has<sp/>valid<sp/>version<sp/>specifications,</highlight></codeline>
<codeline lineno="6"><highlight class="stringliteral">and<sp/>includes<sp/>security-pinned<sp/>dependencies.</highlight></codeline>
<codeline lineno="7"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="8"><highlight class="stringliteral">Note:<sp/>Bandit<sp/>B101<sp/>(assert_used)<sp/>is<sp/>suppressed<sp/>for<sp/>this<sp/>test<sp/>file<sp/>as<sp/>assert</highlight></codeline>
<codeline lineno="9"><highlight class="stringliteral">statements<sp/>are<sp/>the<sp/>standard<sp/>and<sp/>required<sp/>pattern<sp/>in<sp/>pytest<sp/>test<sp/>files.</highlight></codeline>
<codeline lineno="10"><highlight class="stringliteral">&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="comment">#<sp/>nosec<sp/>B101<sp/><sp/>#<sp/>Suppress<sp/>Bandit<sp/>assert<sp/>warnings<sp/>-<sp/>assert<sp/>is<sp/>correct<sp/>in<sp/>pytest<sp/>tests</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>re</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>pathlib<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Path</highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>List,<sp/>Tuple</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>pytest</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>packaging.requirements<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>InvalidRequirement,<sp/>Requirement</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Path<sp/>to<sp/>requirements.txt<sp/>file<sp/>(production<sp/>dependencies)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22" refid="namespacetests_1_1integration_1_1test__requirements_1a74f1a9ad4502de77613aec1cc7ad3260" refkind="member"><highlight class="normal">REQUIREMENTS_FILE<sp/>=<sp/>Path(__file__).parent.parent.parent<sp/>/<sp/></highlight><highlight class="stringliteral">&quot;requirements.txt&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight></codeline>
<codeline lineno="25" refid="namespacetests_1_1integration_1_1test__requirements_1a979f85cc6fc4eaa1143477069cb8b99a" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacetests_1_1integration_1_1test__requirements_1a979f85cc6fc4eaa1143477069cb8b99a" kindref="member">parse_requirements</ref>(file_path:<sp/>Path)<sp/>-&gt;<sp/>List[Tuple[str,<sp/>str]]:</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Parse<sp/>requirements<sp/>file<sp/>and<sp/>return<sp/>list<sp/>of<sp/>(package,<sp/>version_spec)<sp/>tuples.</highlight></codeline>
<codeline lineno="27"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="28"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Examples:</highlight></codeline>
<codeline lineno="29"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Input<sp/>line:<sp/>&quot;requests&gt;=2.25.0&quot;</highlight></codeline>
<codeline lineno="30"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Output:<sp/>(&quot;requests&quot;,<sp/>&quot;&gt;=2.25.0&quot;)</highlight></codeline>
<codeline lineno="31"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="32"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Input<sp/>line:<sp/>&quot;pytest&gt;=6.0,&lt;7.0<sp/>#<sp/>testing<sp/>framework&quot;</highlight></codeline>
<codeline lineno="33"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Output:<sp/>(&quot;pytest&quot;,<sp/>&quot;&gt;=6.0,&lt;7.0&quot;)</highlight></codeline>
<codeline lineno="34"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="35"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Input<sp/>line:<sp/>&quot;pandas&quot;</highlight></codeline>
<codeline lineno="36"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Output:<sp/>(&quot;pandas&quot;,<sp/>&quot;&quot;)</highlight></codeline>
<codeline lineno="37"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="38"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Input<sp/>line:<sp/>&quot;package[extra1,extra2]&gt;=1.0&quot;</highlight></codeline>
<codeline lineno="39"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Output:<sp/>(&quot;package&quot;,<sp/>&quot;&gt;=1.0&quot;)</highlight></codeline>
<codeline lineno="40"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="41"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Raises:</highlight></codeline>
<codeline lineno="42"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ValueError:<sp/>If<sp/>a<sp/>requirement<sp/>line<sp/>is<sp/>malformed.</highlight></codeline>
<codeline lineno="43"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>OSError:<sp/>If<sp/>the<sp/>requirements<sp/>file<sp/>could<sp/>not<sp/>be<sp/>opened<sp/>or<sp/>read.</highlight></codeline>
<codeline lineno="44"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/>requirements<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>open(file_path,<sp/></highlight><highlight class="stringliteral">&quot;r&quot;</highlight><highlight class="normal">,<sp/>encoding=</highlight><highlight class="stringliteral">&quot;utf-8&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>f:</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>line<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>f:</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>line<sp/>=<sp/>line.strip()</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>line<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>line.startswith(</highlight><highlight class="stringliteral">&quot;#&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>inline<sp/>comments</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>line<sp/>=<sp/>line.split(</highlight><highlight class="stringliteral">&quot;#&quot;</highlight><highlight class="normal">)[0].strip()</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>req<sp/>=<sp/>Requirement(line)</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>InvalidRequirement<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(f</highlight><highlight class="stringliteral">&quot;Invalid<sp/>requirement<sp/>line:<sp/>{line}&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>e</highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Preserve<sp/>the<sp/>package<sp/>token<sp/>as<sp/>written<sp/>in<sp/>the<sp/>requirements<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>raw_pkg_token<sp/>=<sp/>line.split(</highlight><highlight class="stringliteral">&quot;;&quot;</highlight><highlight class="normal">,<sp/>1)[0]<sp/><sp/></highlight><highlight class="comment">#<sp/>drop<sp/>environment<sp/>markers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>raw_pkg_token<sp/>=<sp/>raw_pkg_token.split(</highlight><highlight class="stringliteral">&quot;[&quot;</highlight><highlight class="normal">,<sp/>1)[0]<sp/><sp/></highlight><highlight class="comment">#<sp/>drop<sp/>extras</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pkg_part<sp/>=<sp/>re.split(</highlight><highlight class="stringliteral">r&quot;(?=[&lt;&gt;=!~,])&quot;</highlight><highlight class="normal">,<sp/>raw_pkg_token,<sp/>1)[0].strip()</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pkg<sp/>=<sp/>pkg_part<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>req.name.strip()</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specifier_str<sp/>=<sp/>str(req.specifier).strip()</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>specifier_str:</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specifier_str<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">.join(s.strip()<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>s<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>specifier_str.split(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>s.strip())</highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>requirements.append((pkg,<sp/>specifier_str))</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>OSError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>OSError(f</highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>read<sp/>requirements<sp/>file:<sp/>{file_path}&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>e</highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>requirements</highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileExists" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileExists" kindref="compound">TestRequirementsFileExists</ref>:</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>the<sp/>requirements.txt<sp/>file<sp/>exists<sp/>and<sp/>is<sp/>accessible.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="83" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileExists_1aa1145b76125f462adebb01f0675a4027" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileExists_1aa1145b76125f462adebb01f0675a4027" kindref="member">test_file_exists</ref>():</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>requirements.txt<sp/>file<sp/>exists.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>REQUIREMENTS_FILE.exists()</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileExists_1aec2dabef2f84e348a35509f61d005e1e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileExists_1aec2dabef2f84e348a35509f61d005e1e" kindref="member">test_file_is_file</ref>():</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>requirements.txt<sp/>is<sp/>a<sp/>file,<sp/>not<sp/>a<sp/>directory.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>REQUIREMENTS_FILE.is_file()</highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileExists_1a252a92cdd54d4554d5de3075725aabe4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileExists_1a252a92cdd54d4554d5de3075725aabe4" kindref="member">test_file_is_readable</ref>():</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>the<sp/>file<sp/>can<sp/>be<sp/>read.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>open(REQUIREMENTS_FILE,<sp/></highlight><highlight class="stringliteral">&quot;r&quot;</highlight><highlight class="normal">,<sp/>encoding=</highlight><highlight class="stringliteral">&quot;utf-8&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>f:</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>content<sp/>=<sp/>f.read()</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(content)<sp/>&gt;<sp/>0</highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat" kindref="compound">TestRequirementsFileFormat</ref>:</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>requirements.txt<sp/>file<sp/>formatting<sp/>and<sp/>structure.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@pytest.fixture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="104" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat_1ad4a251b2239c941483267cad911bddf4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat_1ad4a251b2239c941483267cad911bddf4" kindref="member">file_content</ref>(self)<sp/>-&gt;<sp/>str:</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Load<sp/>requirements<sp/>file<sp/>content.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>open(REQUIREMENTS_FILE,<sp/></highlight><highlight class="stringliteral">&quot;r&quot;</highlight><highlight class="normal">,<sp/>encoding=</highlight><highlight class="stringliteral">&quot;utf-8&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>f:</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>f.read()</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@pytest.fixture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat_1ad9ba91d4b819b668b7cc669ed272667f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat_1ad9ba91d4b819b668b7cc669ed272667f" kindref="member">file_lines</ref>(self)<sp/>-&gt;<sp/>List[str]:</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Load<sp/>requirements<sp/>file<sp/>as<sp/>list<sp/>of<sp/>lines.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>open(REQUIREMENTS_FILE,<sp/></highlight><highlight class="stringliteral">&quot;r&quot;</highlight><highlight class="normal">,<sp/>encoding=</highlight><highlight class="stringliteral">&quot;utf-8&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>f:</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>f.readlines()</highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="116" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat_1a307b476edb26fbfbf7f3292ac1df8f95" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat_1a307b476edb26fbfbf7f3292ac1df8f95" kindref="member">test_file_encoding</ref>():</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>file<sp/>uses<sp/>UTF-8<sp/>encoding.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>open(REQUIREMENTS_FILE,<sp/></highlight><highlight class="stringliteral">&quot;r&quot;</highlight><highlight class="normal">,<sp/>encoding=</highlight><highlight class="stringliteral">&quot;utf-8&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>f:</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f.read()</highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat_1a1746734a640ae83356ab195eccd3bd5c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat_1a1746734a640ae83356ab195eccd3bd5c" kindref="member">test_no_trailing_whitespace</ref>(file_lines:<sp/>List[str]):</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>lines<sp/>don&apos;t<sp/>have<sp/>trailing<sp/>whitespace.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lines_with_trailing<sp/>=<sp/>[</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(i<sp/>+<sp/>1,<sp/>repr(line))<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i,<sp/>line<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>enumerate(file_lines)<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>line.rstrip(</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">)<sp/>!=<sp/>line.rstrip()</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>]</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(lines_with_trailing)<sp/>==<sp/>0,<sp/>f</highlight><highlight class="stringliteral">&quot;Lines<sp/>with<sp/>trailing<sp/>whitespace:<sp/>{lines_with_trailing}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="130" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat_1a90de39f398d52eaf95115b6f9099a935" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat_1a90de39f398d52eaf95115b6f9099a935" kindref="member">test_ends_with_newline</ref>(file_content:<sp/>str):</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>file<sp/>ends<sp/>with<sp/>a<sp/>newline.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>file_content.endswith(</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">),<sp/></highlight><highlight class="stringliteral">&quot;File<sp/>should<sp/>end<sp/>with<sp/>a<sp/>newline<sp/>character&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat_1aa4aef045a1d79cebe81e80cfd8f97233" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequirementsFileFormat_1aa4aef045a1d79cebe81e80cfd8f97233" kindref="member">test_no_blank_lines_in_middle</ref>(file_lines:<sp/>List[str]):</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>there<sp/>are<sp/>no<sp/>excessive<sp/>blank<sp/>lines<sp/>(max<sp/>1<sp/>consecutive).&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>consecutive_blanks<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>max_consecutive<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>line<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>file_lines:</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>line.strip()<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>consecutive_blanks<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>max_consecutive<sp/>=<sp/>max(max_consecutive,<sp/>consecutive_blanks)</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>consecutive_blanks<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>max_consecutive<sp/>&lt;=<sp/>1,<sp/>f</highlight><highlight class="stringliteral">&quot;Found<sp/>{max_consecutive}<sp/>consecutive<sp/>blank<sp/>lines&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight></codeline>
<codeline lineno="148" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages" kindref="compound">TestRequiredPackages</ref>:</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>required<sp/>production<sp/>packages<sp/>are<sp/>present.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@pytest.fixture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1aa1a71f943bdbeba26738655572bf9a01" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1aa1a71f943bdbeba26738655572bf9a01" kindref="member">requirements</ref>()<sp/>-&gt;<sp/>List[Tuple[str,<sp/>str]]:</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Parse<sp/>requirements<sp/>and<sp/>return<sp/>list<sp/>of<sp/>(package,<sp/>version)<sp/>tuples.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespacetests_1_1integration_1_1test__requirements_1a979f85cc6fc4eaa1143477069cb8b99a" kindref="member">parse_requirements</ref>(REQUIREMENTS_FILE)</highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@pytest.fixture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1a12b47841ec09960288b867c6bccf59f3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1a12b47841ec09960288b867c6bccf59f3" kindref="member">package_names</ref>(requirements:<sp/>List[Tuple[str,<sp/>str]])<sp/>-&gt;<sp/>List[str]:</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Extract<sp/>package<sp/>names<sp/>from<sp/>requirements.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>[pkg.lower()<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>_<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements]</highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1a84033a9091c69442c2a0e51f42bce3c2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1a84033a9091c69442c2a0e51f42bce3c2" kindref="member">test_has_core_packages</ref>(package_names:<sp/>List[str]):</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>core<sp/>application<sp/>packages<sp/>are<sp/>present.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Based<sp/>on<sp/>the<sp/>application<sp/>structure,<sp/>these<sp/>are<sp/>likely<sp/>core<sp/>dependencies</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(package_names)<sp/>&gt;<sp/>0,<sp/></highlight><highlight class="stringliteral">&quot;Requirements<sp/>file<sp/>should<sp/>not<sp/>be<sp/>empty&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1ab65d02b51095ab51c92db5db77dada59" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1ab65d02b51095ab51c92db5db77dada59" kindref="member">test_has_fastapi</ref>(package_names:<sp/>List[str]):</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>FastAPI<sp/>is<sp/>included<sp/>for<sp/>API<sp/>framework.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;fastapi&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>package_names</highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1a0d99319e978d1177e22681a59d79d0eb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1a0d99319e978d1177e22681a59d79d0eb" kindref="member">test_has_uvicorn</ref>(package_names:<sp/>List[str]):</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>uvicorn<sp/>is<sp/>included<sp/>for<sp/>ASGI<sp/>server.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;uvicorn&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>package_names</highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1a45c8ec9dde12fa7de99228d9a8017244" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1a45c8ec9dde12fa7de99228d9a8017244" kindref="member">test_has_pydantic</ref>(package_names:<sp/>List[str]):</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>pydantic<sp/>is<sp/>included<sp/>for<sp/>data<sp/>validation.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;pydantic&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>package_names</highlight></codeline>
<codeline lineno="183"><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="185" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1a068332b57fc245ef5c1fd9f4fbfe7284" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1a068332b57fc245ef5c1fd9f4fbfe7284" kindref="member">test_has_httpx</ref>(package_names:<sp/>List[str]):</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>httpx<sp/>is<sp/>included<sp/>for<sp/>HTTP<sp/>client.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;httpx&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>package_names</highlight></codeline>
<codeline lineno="188"><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="190" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1a6a58a4ede7512a7f555f97bc59930e14" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1a6a58a4ede7512a7f555f97bc59930e14" kindref="member">test_has_pytest</ref>(package_names:<sp/>List[str]):</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>pytest<sp/>is<sp/>included<sp/>for<sp/>testing.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;pytest&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>package_names</highlight></codeline>
<codeline lineno="193"><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="195" refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1af2f708a63ca73f17e89ceed4d5cec4f2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestRequiredPackages_1af2f708a63ca73f17e89ceed4d5cec4f2" kindref="member">test_has_security_pinned_packages</ref>(requirements:<sp/>List[Tuple[str,<sp/>str]]):</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>security-pinned<sp/>packages<sp/>are<sp/>present<sp/>with<sp/>comments.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Check<sp/>for<sp/>zipp<sp/>which<sp/>was<sp/>added<sp/>as<sp/>a<sp/>security<sp/>fix</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zipp_entries<sp/>=<sp/>[pkg<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>_<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>pkg.lower()<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;zipp&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(zipp_entries)<sp/>&gt;<sp/>0,<sp/></highlight><highlight class="stringliteral">&quot;Security-pinned<sp/>package<sp/>&apos;zipp&apos;<sp/>should<sp/>be<sp/>present&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202" refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications" kindref="compound">TestVersionSpecifications</ref>:</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>version<sp/>specifications<sp/>and<sp/>constraints.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@pytest.fixture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207" refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications_1a0f6ad1f2d85bd00b01429f3f08ac984e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications_1a0f6ad1f2d85bd00b01429f3f08ac984e" kindref="member">requirements</ref>()<sp/>-&gt;<sp/>List[Tuple[str,<sp/>str]]:</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Parse<sp/>requirements<sp/>and<sp/>return<sp/>list<sp/>of<sp/>(package,<sp/>version)<sp/>tuples.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespacetests_1_1integration_1_1test__requirements_1a979f85cc6fc4eaa1143477069cb8b99a" kindref="member">parse_requirements</ref>(REQUIREMENTS_FILE)</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight></codeline>
<codeline lineno="211" refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications_1a80ef254b05a467ca11f7fbe9f00501cd" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications_1a80ef254b05a467ca11f7fbe9f00501cd" kindref="member">test_all_packages_parseable</ref>(self,<sp/>requirements:<sp/>List[Tuple[str,<sp/>str]]):</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>all<sp/>package<sp/>specifications<sp/>are<sp/>parseable.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(requirements)<sp/>&gt;<sp/>0</highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight></codeline>
<codeline lineno="215" refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications_1ab5b6936c57f653071753997e48d2fe51" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications_1ab5b6936c57f653071753997e48d2fe51" kindref="member">test_version_format_valid</ref>(self,<sp/>requirements:<sp/>List[Tuple[str,<sp/>str]]):</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>version<sp/>specifications<sp/>use<sp/>valid<sp/>format.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>version_pattern<sp/>=<sp/>re.compile(</highlight><highlight class="stringliteral">r&quot;^(&gt;=|==|&lt;=|&gt;|&lt;|~=)\d+(\.\d+)*$&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>ver_spec<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements:</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ver_spec:</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Split<sp/>compound<sp/>version<sp/>specs<sp/>(e.g.,<sp/>&quot;&gt;=1.0,&lt;2.0&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>spec<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ver_spec.split(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spec<sp/>=<sp/>spec.strip()</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>version_pattern.match(spec),<sp/>f</highlight><highlight class="stringliteral">&quot;Invalid<sp/>version<sp/>spec<sp/>&apos;{spec}&apos;<sp/>for<sp/>package<sp/>&apos;{pkg}&apos;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight></codeline>
<codeline lineno="226" refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications_1aa89bedb5a11caa9793374324f09bbac4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications_1aa89bedb5a11caa9793374324f09bbac4" kindref="member">test_zipp_security_version</ref>(self,<sp/>requirements:<sp/>List[Tuple[str,<sp/>str]]):</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>zipp<sp/>has<sp/>the<sp/>security-required<sp/>minimum<sp/>version.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zipp_specs<sp/>=<sp/>[ver<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>ver<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>pkg.lower()<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;zipp&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(zipp_specs)<sp/>&gt;<sp/>0,<sp/></highlight><highlight class="stringliteral">&quot;zipp<sp/>should<sp/>be<sp/>present<sp/>for<sp/>security<sp/>fix&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>zipp_specs[0].startswith(</highlight><highlight class="stringliteral">&quot;&gt;=3.19&quot;</highlight><highlight class="normal">),<sp/>f</highlight><highlight class="stringliteral">&quot;zipp<sp/>should<sp/>be<sp/>&gt;=3.19.1,<sp/>got<sp/>{zipp_specs[0]}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"></highlight></codeline>
<codeline lineno="232" refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications_1a33ecf63839d7596fb8e046884e5d1ff0" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications_1a33ecf63839d7596fb8e046884e5d1ff0" kindref="member">test_uses_minimum_versions</ref>(self,<sp/>requirements:<sp/>List[Tuple[str,<sp/>str]]):</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>most<sp/>packages<sp/>use<sp/>&gt;=<sp/>for<sp/>version<sp/>specifications.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specs_using_gte<sp/>=<sp/>[ver<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>ver<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ver.startswith(</highlight><highlight class="stringliteral">&quot;&gt;=&quot;</highlight><highlight class="normal">)]</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>all_with_versions<sp/>=<sp/>[ver<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>ver<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ver]</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>At<sp/>least<sp/>70%<sp/>should<sp/>use<sp/>&gt;=<sp/>for<sp/>flexibility</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(specs_using_gte)<sp/>&gt;=<sp/>len(all_with_versions)<sp/>*<sp/>0.7</highlight></codeline>
<codeline lineno="238"><highlight class="normal"></highlight></codeline>
<codeline lineno="239" refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications_1a745328a5018c6626efec79619a8abb3f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestVersionSpecifications_1a745328a5018c6626efec79619a8abb3f" kindref="member">test_no_exact_pins_without_comment</ref>(self,<sp/>requirements:<sp/>List[Tuple[str,<sp/>str]]):</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>exact<sp/>pins<sp/>(==)<sp/>are<sp/>documented<sp/>with<sp/>comments<sp/>in<sp/>the<sp/>file.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>open(REQUIREMENTS_FILE,<sp/></highlight><highlight class="stringliteral">&quot;r&quot;</highlight><highlight class="normal">,<sp/>encoding=</highlight><highlight class="stringliteral">&quot;utf-8&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>f:</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lines<sp/>=<sp/>f.readlines()</highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exact_pins<sp/>=<sp/>[pkg<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>ver<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ver.startswith(</highlight><highlight class="stringliteral">&quot;==&quot;</highlight><highlight class="normal">)]</highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>exact_pins:</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Find<sp/>the<sp/>line<sp/>with<sp/>this<sp/>package</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pkg_lines<sp/>=<sp/>[line<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>line<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>lines<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>pkg.lower()<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>line.lower()<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;==&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>line]</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(pkg_lines)<sp/>&gt;<sp/>0,<sp/>f</highlight><highlight class="stringliteral">&quot;Package<sp/>{pkg}<sp/>not<sp/>found<sp/>in<sp/>file&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Check<sp/>if<sp/>there&apos;s<sp/>a<sp/>comment<sp/>on<sp/>the<sp/>same<sp/>line<sp/>or<sp/>nearby</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>has_comment<sp/>=<sp/>any(</highlight><highlight class="stringliteral">&quot;#&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>line<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>line<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>pkg_lines)</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>has_comment,<sp/>f</highlight><highlight class="stringliteral">&quot;Exact<sp/>pin<sp/>for<sp/>{pkg}<sp/>should<sp/>have<sp/>a<sp/>comment<sp/>explaining<sp/>why&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255" refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency" kindref="compound">TestPackageConsistency</ref>:</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>package<sp/>consistency<sp/>and<sp/>naming<sp/>conventions.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@pytest.fixture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260" refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency_1ac91fb341b5166817ba5b733a0db9aa87" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency_1ac91fb341b5166817ba5b733a0db9aa87" kindref="member">requirements</ref>()<sp/>-&gt;<sp/>List[Tuple[str,<sp/>str]]:</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Parse<sp/>requirements<sp/>and<sp/>return<sp/>list<sp/>of<sp/>(package,<sp/>version)<sp/>tuples.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespacetests_1_1integration_1_1test__requirements_1a979f85cc6fc4eaa1143477069cb8b99a" kindref="member">parse_requirements</ref>(REQUIREMENTS_FILE)</highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@pytest.fixture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266" refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency_1a10811a9258b316ab13615a21890a8102" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency_1a10811a9258b316ab13615a21890a8102" kindref="member">package_names</ref>(requirements:<sp/>List[Tuple[str,<sp/>str]])<sp/>-&gt;<sp/>List[str]:</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Extract<sp/>package<sp/>names<sp/>from<sp/>requirements.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>[pkg<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>_<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements]</highlight></codeline>
<codeline lineno="269"><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="271" refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency_1a75459c9ecf96155eb6930318e5e01442" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency_1a75459c9ecf96155eb6930318e5e01442" kindref="member">test_no_duplicate_packages</ref>(package_names:<sp/>List[str]):</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>no<sp/>package<sp/>is<sp/>listed<sp/>multiple<sp/>times.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lowercase_names<sp/>=<sp/>[name.lower()<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>name<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>package_names]</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>duplicates<sp/>=<sp/>[name<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>name<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>lowercase_names<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>lowercase_names.count(name)<sp/>&gt;<sp/>1]</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(set(duplicates))<sp/>==<sp/>0,<sp/>f</highlight><highlight class="stringliteral">&quot;Duplicate<sp/>packages<sp/>found:<sp/>{set(duplicates)}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="278" refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency_1a7c873104b33f50cccfac86995e645dda" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency_1a7c873104b33f50cccfac86995e645dda" kindref="member">test_packages_sorted_logically</ref>(package_names:<sp/>List[str]):</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>packages<sp/>are<sp/>organized<sp/>in<sp/>logical<sp/>groups.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>We<sp/>don&apos;t<sp/>enforce<sp/>strict<sp/>alphabetical<sp/>sorting,<sp/>but<sp/>check<sp/>for<sp/>some<sp/>organization</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(package_names)<sp/>&gt;<sp/>0</highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284" refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency_1a8c023589ea3c0c5e78384803fdfed29d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency_1a8c023589ea3c0c5e78384803fdfed29d" kindref="member">test_package_names_valid</ref>(package_names:<sp/>List[str]):</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>package<sp/>names<sp/>follow<sp/>valid<sp/>naming<sp/>conventions.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>valid_name_pattern<sp/>=<sp/>re.compile(</highlight><highlight class="stringliteral">r&quot;^[a-zA-Z0-9_-]+$&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalid_names<sp/>=<sp/>[pkg<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>package_names<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>valid_name_pattern.match(pkg)]</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(invalid_names)<sp/>==<sp/>0,<sp/>f</highlight><highlight class="stringliteral">&quot;Invalid<sp/>package<sp/>names:<sp/>{invalid_names}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="292" refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency_1a5351999f53b9c0be19a0064c9341a25f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestPackageConsistency_1a5351999f53b9c0be19a0064c9341a25f" kindref="member">test_no_conflicting_packages</ref>(package_names:<sp/>List[str]):</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>there<sp/>are<sp/>no<sp/>known<sp/>conflicting<sp/>packages.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Check<sp/>for<sp/>common<sp/>conflicts<sp/>(example:<sp/>different<sp/>database<sp/>drivers)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lowercase_names<sp/>=<sp/>[name.lower()<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>name<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>package_names]</highlight></codeline>
<codeline lineno="296"><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>These<sp/>are<sp/>examples<sp/>-<sp/>adjust<sp/>based<sp/>on<sp/>actual<sp/>conflicts<sp/>in<sp/>the<sp/>ecosystem</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conflicts<sp/>=<sp/>[</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>({</highlight><highlight class="stringliteral">&quot;mysql-connector-python&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;pymysql&quot;</highlight><highlight class="normal">},<sp/></highlight><highlight class="stringliteral">&quot;Multiple<sp/>MySQL<sp/>connectors&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>({</highlight><highlight class="stringliteral">&quot;psycopg2&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;psycopg2-binary&quot;</highlight><highlight class="normal">},<sp/></highlight><highlight class="stringliteral">&quot;Conflicting<sp/>psycopg2<sp/>packages&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>]</highlight></codeline>
<codeline lineno="302"><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>conflict_set,<sp/>message<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>conflicts:</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>found<sp/>=<sp/>conflict_set.intersection(set(lowercase_names))</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(found)<sp/>&lt;=<sp/>1,<sp/>f</highlight><highlight class="stringliteral">&quot;{message}:<sp/>{found}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308" refid="classtests_1_1integration_1_1test__requirements_1_1TestFileOrganization" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestFileOrganization" kindref="compound">TestFileOrganization</ref>:</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>file<sp/>organization<sp/>and<sp/>structure.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@pytest.fixture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="313" refid="classtests_1_1integration_1_1test__requirements_1_1TestFileOrganization_1a1e1d0e6e52b97376d48eb54efdd1d58d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestFileOrganization_1a1e1d0e6e52b97376d48eb54efdd1d58d" kindref="member">file_lines</ref>()<sp/>-&gt;<sp/>List[str]:</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Load<sp/>requirements<sp/>file<sp/>as<sp/>list<sp/>of<sp/>lines.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>open(REQUIREMENTS_FILE,<sp/></highlight><highlight class="stringliteral">&quot;r&quot;</highlight><highlight class="normal">,<sp/>encoding=</highlight><highlight class="stringliteral">&quot;utf-8&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>f:</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>f.readlines()</highlight></codeline>
<codeline lineno="317"><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="319" refid="classtests_1_1integration_1_1test__requirements_1_1TestFileOrganization_1af292b1dbb5dfd907dc2f96e5dbf24410" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestFileOrganization_1af292b1dbb5dfd907dc2f96e5dbf24410" kindref="member">test_reasonable_file_size</ref>(file_lines:<sp/>List[str]):</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>file<sp/>size<sp/>is<sp/>reasonable<sp/>(not<sp/>too<sp/>large).&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Production<sp/>requirements<sp/>should<sp/>typically<sp/>be<sp/>under<sp/>100<sp/>lines</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(file_lines)<sp/>&lt;<sp/>200,<sp/>f</highlight><highlight class="stringliteral">&quot;Requirements<sp/>file<sp/>is<sp/>too<sp/>large:<sp/>{len(file_lines)}<sp/>lines&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="325" refid="classtests_1_1integration_1_1test__requirements_1_1TestFileOrganization_1aa95f303a6e4c2802e273f1ca9b52627d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestFileOrganization_1aa95f303a6e4c2802e273f1ca9b52627d" kindref="member">test_has_comments_for_sections</ref>(file_lines:<sp/>List[str]):</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>file<sp/>has<sp/>organizational<sp/>comments.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comment_lines<sp/>=<sp/>[line<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>line<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>file_lines<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>line.strip().startswith(</highlight><highlight class="stringliteral">&quot;#&quot;</highlight><highlight class="normal">)]</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Should<sp/>have<sp/>at<sp/>least<sp/>some<sp/>comments<sp/>for<sp/>organization</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(comment_lines)<sp/>&gt;<sp/>0,<sp/></highlight><highlight class="stringliteral">&quot;File<sp/>should<sp/>have<sp/>comments<sp/>for<sp/>organization&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight></codeline>
<codeline lineno="332" refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance" kindref="compound">TestSecurityAndCompliance</ref>:</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>security-related<sp/>requirements<sp/>and<sp/>compliance.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@pytest.fixture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="337" refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance_1acbd902698dae86028efdf5a733984595" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance_1acbd902698dae86028efdf5a733984595" kindref="member">requirements</ref>()<sp/>-&gt;<sp/>List[Tuple[str,<sp/>str]]:</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Parse<sp/>requirements<sp/>and<sp/>return<sp/>list<sp/>of<sp/>(package,<sp/>version)<sp/>tuples.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespacetests_1_1integration_1_1test__requirements_1a979f85cc6fc4eaa1143477069cb8b99a" kindref="member">parse_requirements</ref>(REQUIREMENTS_FILE)</highlight></codeline>
<codeline lineno="340"><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@pytest.fixture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="343" refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance_1a6db97267b7f6939e9c1ccf7e63d553c4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance_1a6db97267b7f6939e9c1ccf7e63d553c4" kindref="member">file_content</ref>()<sp/>-&gt;<sp/>str:</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Load<sp/>requirements<sp/>file<sp/>content.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>open(REQUIREMENTS_FILE,<sp/></highlight><highlight class="stringliteral">&quot;r&quot;</highlight><highlight class="normal">,<sp/>encoding=</highlight><highlight class="stringliteral">&quot;utf-8&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>f:</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>f.read()</highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="349" refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance_1ae3b536012582da37e8bb68aad71224f7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance_1ae3b536012582da37e8bb68aad71224f7" kindref="member">test_zipp_security_fix_present</ref>(requirements:<sp/>List[Tuple[str,<sp/>str]]):</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>zipp<sp/>security<sp/>fix<sp/>is<sp/>present.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zipp_entries<sp/>=<sp/>[(pkg,<sp/>ver)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>ver<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>pkg.lower()<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;zipp&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(zipp_entries)<sp/>==<sp/>1,<sp/></highlight><highlight class="stringliteral">&quot;zipp<sp/>security<sp/>pin<sp/>should<sp/>be<sp/>present<sp/>exactly<sp/>once&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pkg,<sp/>ver<sp/>=<sp/>zipp_entries[0]</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>ver<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;&gt;=3.19.1&quot;</highlight><highlight class="normal">,<sp/>f</highlight><highlight class="stringliteral">&quot;zipp<sp/>version<sp/>should<sp/>be<sp/>&gt;=3.19.1,<sp/>got<sp/>{ver}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="357" refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance_1a92542926113e24f936aef3e021d2a256" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance_1a92542926113e24f936aef3e021d2a256" kindref="member">test_zipp_has_security_comment</ref>(file_content:<sp/>str):</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>zipp<sp/>entry<sp/>has<sp/>a<sp/>comment<sp/>explaining<sp/>it&apos;s<sp/>for<sp/>security.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Find<sp/>the<sp/>zipp<sp/>line</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lines<sp/>=<sp/>file_content.split(</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zipp_lines<sp/>=<sp/>[line<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>line<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>lines<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;zipp&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>line.lower()<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>line.strip().startswith(</highlight><highlight class="stringliteral">&quot;#&quot;</highlight><highlight class="normal">)]</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(zipp_lines)<sp/>&gt;<sp/>0,<sp/></highlight><highlight class="stringliteral">&quot;zipp<sp/>line<sp/>not<sp/>found&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"></highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zipp_line<sp/>=<sp/>zipp_lines[0]</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Check<sp/>for<sp/>security-related<sp/>keywords<sp/>in<sp/>comment</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;#&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>zipp_line,<sp/></highlight><highlight class="stringliteral">&quot;zipp<sp/>line<sp/>should<sp/>have<sp/>a<sp/>comment&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comment<sp/>=<sp/>zipp_line.split(</highlight><highlight class="stringliteral">&quot;#&quot;</highlight><highlight class="normal">,<sp/>1)[1].lower()</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>security_keywords<sp/>=<sp/>[</highlight><highlight class="stringliteral">&quot;security&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;vulnerability&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;snyk&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;pinned&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>any(</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>keyword<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>comment<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>keyword<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>security_keywords</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),<sp/>f</highlight><highlight class="stringliteral">&quot;zipp<sp/>comment<sp/>should<sp/>mention<sp/>security/vulnerability,<sp/>got:<sp/>{comment}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"></highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="374" refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance_1adbdbad5cb71074a0c4818c8bf3a6831b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestSecurityAndCompliance_1adbdbad5cb71074a0c4818c8bf3a6831b" kindref="member">test_no_known_vulnerable_versions</ref>(requirements:<sp/>List[Tuple[str,<sp/>str]]):</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>packages<sp/>don&apos;t<sp/>use<sp/>known<sp/>vulnerable<sp/>version<sp/>patterns.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>This<sp/>is<sp/>a<sp/>basic<sp/>check<sp/>-<sp/>in<sp/>production,<sp/>integrate<sp/>with<sp/>safety<sp/>or<sp/>snyk</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>_,<sp/>ver<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements:</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Example:<sp/>check<sp/>that<sp/>we&apos;re<sp/>not<sp/>using<sp/>very<sp/>old<sp/>versions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ver.startswith(</highlight><highlight class="stringliteral">&quot;==&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>version_match<sp/>=<sp/>re.search(</highlight><highlight class="stringliteral">r&quot;==(\d+)\.(\d+)&quot;</highlight><highlight class="normal">,<sp/>ver)</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>version_match:</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_<sp/>=<sp/>int(version_match.group(1))</highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"></highlight></codeline>
<codeline lineno="385" refid="classtests_1_1integration_1_1test__requirements_1_1TestEdgeCases" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestEdgeCases" kindref="compound">TestEdgeCases</ref>:</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>edge<sp/>cases<sp/>and<sp/>error<sp/>handling<sp/>in<sp/>requirements<sp/>parsing.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="389" refid="classtests_1_1integration_1_1test__requirements_1_1TestEdgeCases_1aa616898584d423d3221b145553e7de8f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestEdgeCases_1aa616898584d423d3221b145553e7de8f" kindref="member">test_parse_with_extras</ref>():</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>parsing<sp/>packages<sp/>with<sp/>extras.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Test<sp/>that<sp/>packages<sp/>with<sp/>extras<sp/>are<sp/>handled<sp/>correctly</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>requirements<sp/>=<sp/><ref refid="namespacetests_1_1integration_1_1test__requirements_1a979f85cc6fc4eaa1143477069cb8b99a" kindref="member">parse_requirements</ref>(REQUIREMENTS_FILE)</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>If<sp/>any<sp/>package<sp/>has<sp/>extras,<sp/>ensure<sp/>it&apos;s<sp/>parsed<sp/>correctly</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>_<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements:</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;[&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>pkg,<sp/>f</highlight><highlight class="stringliteral">&quot;Package<sp/>name<sp/>should<sp/>not<sp/>contain<sp/>&apos;[&apos;:<sp/>{pkg}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="396"><highlight class="normal"></highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="398" refid="classtests_1_1integration_1_1test__requirements_1_1TestEdgeCases_1a9a97af0b2c8fd13af81ccf66004a990b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestEdgeCases_1a9a97af0b2c8fd13af81ccf66004a990b" kindref="member">test_parse_with_environment_markers</ref>():</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>parsing<sp/>packages<sp/>with<sp/>environment<sp/>markers.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>requirements<sp/>=<sp/><ref refid="namespacetests_1_1integration_1_1test__requirements_1a979f85cc6fc4eaa1143477069cb8b99a" kindref="member">parse_requirements</ref>(REQUIREMENTS_FILE)</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Ensure<sp/>environment<sp/>markers<sp/>are<sp/>stripped</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>ver<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements:</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;;&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>pkg,<sp/>f</highlight><highlight class="stringliteral">&quot;Package<sp/>name<sp/>should<sp/>not<sp/>contain<sp/>&apos;;&apos;:<sp/>{pkg}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;;&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ver,<sp/>f</highlight><highlight class="stringliteral">&quot;Version<sp/>spec<sp/>should<sp/>not<sp/>contain<sp/>&apos;;&apos;:<sp/>{ver}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="407" refid="classtests_1_1integration_1_1test__requirements_1_1TestEdgeCases_1ab074b855a77a265f11b8fbdc4fda978c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestEdgeCases_1ab074b855a77a265f11b8fbdc4fda978c" kindref="member">test_parse_with_inline_comments</ref>():</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>inline<sp/>comments<sp/>are<sp/>properly<sp/>handled.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>requirements<sp/>=<sp/><ref refid="namespacetests_1_1integration_1_1test__requirements_1a979f85cc6fc4eaa1143477069cb8b99a" kindref="member">parse_requirements</ref>(REQUIREMENTS_FILE)</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Ensure<sp/>comments<sp/>don&apos;t<sp/>leak<sp/>into<sp/>package<sp/>names<sp/>or<sp/>versions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>ver<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements:</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;#&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>pkg,<sp/>f</highlight><highlight class="stringliteral">&quot;Package<sp/>name<sp/>should<sp/>not<sp/>contain<sp/>&apos;#&apos;:<sp/>{pkg}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;#&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ver,<sp/>f</highlight><highlight class="stringliteral">&quot;Version<sp/>spec<sp/>should<sp/>not<sp/>contain<sp/>&apos;#&apos;:<sp/>{ver}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="416" refid="classtests_1_1integration_1_1test__requirements_1_1TestEdgeCases_1a9d608758c292ac5c36bd748e595e1ffc" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestEdgeCases_1a9d608758c292ac5c36bd748e595e1ffc" kindref="member">test_empty_lines_ignored</ref>():</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>empty<sp/>lines<sp/>and<sp/>comment-only<sp/>lines<sp/>are<sp/>ignored.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>requirements<sp/>=<sp/><ref refid="namespacetests_1_1integration_1_1test__requirements_1a979f85cc6fc4eaa1143477069cb8b99a" kindref="member">parse_requirements</ref>(REQUIREMENTS_FILE)</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>All<sp/>returned<sp/>entries<sp/>should<sp/>have<sp/>valid<sp/>package<sp/>names</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>_<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements:</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(pkg)<sp/>&gt;<sp/>0,<sp/></highlight><highlight class="stringliteral">&quot;Package<sp/>name<sp/>should<sp/>not<sp/>be<sp/>empty&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>pkg.strip()<sp/>==<sp/>pkg,<sp/>f</highlight><highlight class="stringliteral">&quot;Package<sp/>name<sp/>should<sp/>not<sp/>have<sp/>leading/trailing<sp/>whitespace:<sp/>&apos;{pkg}&apos;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight></codeline>
<codeline lineno="425" refid="classtests_1_1integration_1_1test__requirements_1_1TestComprehensiveValidation" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestComprehensiveValidation" kindref="compound">TestComprehensiveValidation</ref>:</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Comprehensive<sp/>validation<sp/>tests<sp/>for<sp/>the<sp/>requirements<sp/>file.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@pytest.fixture</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="430" refid="classtests_1_1integration_1_1test__requirements_1_1TestComprehensiveValidation_1a02970a0221b1c9f67e107e1dd5955903" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestComprehensiveValidation_1a02970a0221b1c9f67e107e1dd5955903" kindref="member">requirements</ref>()<sp/>-&gt;<sp/>List[Tuple[str,<sp/>str]]:</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Parse<sp/>requirements<sp/>and<sp/>return<sp/>list<sp/>of<sp/>(package,<sp/>version)<sp/>tuples.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespacetests_1_1integration_1_1test__requirements_1a979f85cc6fc4eaa1143477069cb8b99a" kindref="member">parse_requirements</ref>(REQUIREMENTS_FILE)</highlight></codeline>
<codeline lineno="433"><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="435" refid="classtests_1_1integration_1_1test__requirements_1_1TestComprehensiveValidation_1a05969584064346f848b69fb3c38ea54e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestComprehensiveValidation_1a05969584064346f848b69fb3c38ea54e" kindref="member">test_all_packages_have_versions_or_pins</ref>(requirements:<sp/>List[Tuple[str,<sp/>str]]):</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>critical<sp/>packages<sp/>have<sp/>version<sp/>specifications.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>packages_without_versions<sp/>=<sp/>[pkg<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>ver<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>ver]</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Allow<sp/>some<sp/>packages<sp/>without<sp/>versions,<sp/>but<sp/>production<sp/>deps<sp/>should<sp/>mostly<sp/>be<sp/>pinned</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>(</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>len(packages_without_versions)<sp/>&lt;=<sp/>len(requirements)<sp/>*<sp/>0.2</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),<sp/>f</highlight><highlight class="stringliteral">&quot;Too<sp/>many<sp/>packages<sp/>without<sp/>versions:<sp/>{packages_without_versions}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="444" refid="classtests_1_1integration_1_1test__requirements_1_1TestComprehensiveValidation_1a6afa90a695cad177dfea61b8fd6a2eb1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestComprehensiveValidation_1a6afa90a695cad177dfea61b8fd6a2eb1" kindref="member">test_version_consistency</ref>(requirements:<sp/>List[Tuple[str,<sp/>str]]):</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>version<sp/>specifications<sp/>are<sp/>consistent<sp/>in<sp/>style.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>version_styles<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>pkg,<sp/>ver<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>requirements:</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ver:</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ver.startswith(</highlight><highlight class="stringliteral">&quot;&gt;=&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>version_styles.setdefault(</highlight><highlight class="stringliteral">&quot;minimum&quot;</highlight><highlight class="normal">,<sp/>[]).append(pkg)</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>ver.startswith(</highlight><highlight class="stringliteral">&quot;==&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>version_styles.setdefault(</highlight><highlight class="stringliteral">&quot;exact&quot;</highlight><highlight class="normal">,<sp/>[]).append(pkg)</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>ver.startswith(</highlight><highlight class="stringliteral">&quot;~=&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>version_styles.setdefault(</highlight><highlight class="stringliteral">&quot;compatible&quot;</highlight><highlight class="normal">,<sp/>[]).append(pkg)</highlight></codeline>
<codeline lineno="455"><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Should<sp/>use<sp/>consistent<sp/>versioning<sp/>strategy<sp/>(mostly<sp/>one<sp/>style)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>version_styles:</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>max_style<sp/>=<sp/>max(version_styles.values(),<sp/>key=len)</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>total_versioned<sp/>=<sp/>sum(len(v)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>v<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>version_styles.values())</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(max_style)<sp/>&gt;=<sp/>total_versioned<sp/>*<sp/>0.6,<sp/></highlight><highlight class="stringliteral">&quot;Version<sp/>specifications<sp/>should<sp/>be<sp/>consistent<sp/>in<sp/>style&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="463" refid="classtests_1_1integration_1_1test__requirements_1_1TestComprehensiveValidation_1ae4c4fc2866ed18ad00d3b3f4e0de70ee" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtests_1_1integration_1_1test__requirements_1_1TestComprehensiveValidation_1ae4c4fc2866ed18ad00d3b3f4e0de70ee" kindref="member">test_transitive_dependencies_documented</ref>(requirements:<sp/>List[Tuple[str,<sp/>str]]):</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Test<sp/>that<sp/>transitive<sp/>dependencies<sp/>are<sp/>documented<sp/>if<sp/>pinned.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>open(REQUIREMENTS_FILE,<sp/></highlight><highlight class="stringliteral">&quot;r&quot;</highlight><highlight class="normal">,<sp/>encoding=</highlight><highlight class="stringliteral">&quot;utf-8&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>f:</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lines<sp/>=<sp/>f.readlines()</highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Packages<sp/>that<sp/>are<sp/>typically<sp/>transitive<sp/>dependencies</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>transitive_indicators<sp/>=<sp/>[</highlight><highlight class="stringliteral">&quot;not<sp/>directly<sp/>required&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;transitive&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;pinned<sp/>by&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="470"><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>line<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>lines:</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>any(indicator<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>line.lower()<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>indicator<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>transitive_indicators):</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>If<sp/>mentioning<sp/>transitive/indirect,<sp/>should<sp/>have<sp/>a<sp/>comment</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;#&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>line,<sp/>f</highlight><highlight class="stringliteral">&quot;Transitive<sp/>dependency<sp/>line<sp/>should<sp/>have<sp/>comment:<sp/>{line}&quot;</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="/app/doc_state/github_reposRepoArchDocGenContext/DashFin-FarDb/financial-asset-relationship-db/tests/integration/test_requirements.py"/>
  </compounddef>
</doxygen>
